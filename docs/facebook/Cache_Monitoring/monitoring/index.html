<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CacheLib Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CacheLib Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="CacheLib" href="/opensearch.xml"><title data-react-helmet="true">Monitoring cache health | CacheLib</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-react-helmet="true" name="twitter:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-react-helmet="true" property="og:url" content="https://cachelib.org/docs/facebook/Cache_Monitoring/monitoring"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Monitoring cache health | CacheLib"><meta data-react-helmet="true" name="description" content="Cachelib offers both ODS and Scuba monitoring for your cache health. To enable monitoring, see Add monitoring for cache. In Scuba and ODS, you can find such information as hit rate, rate of allocations, eviction age, fragmentation, etc. This comprehensive set of metrics helps you to know how well your cache is performing or to debug issues related to your cachelib usage."><meta data-react-helmet="true" property="og:description" content="Cachelib offers both ODS and Scuba monitoring for your cache health. To enable monitoring, see Add monitoring for cache. In Scuba and ODS, you can find such information as hit rate, rate of allocations, eviction age, fragmentation, etc. This comprehensive set of metrics helps you to know how well your cache is performing or to debug issues related to your cachelib usage."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cachelib.org/docs/facebook/Cache_Monitoring/monitoring"><link data-react-helmet="true" rel="alternate" href="https://cachelib.org/docs/facebook/Cache_Monitoring/monitoring" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cachelib.org/docs/facebook/Cache_Monitoring/monitoring" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.118dad3c.css">
<link rel="preload" href="/assets/js/runtime~main.82aea47b.js" as="script">
<link rel="preload" href="/assets/js/main.66604c68.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#20232a;color:#fff" role="banner"><div class="announcementBarContent_6uhP">Support Ukraine 🇺🇦 <a target="_blank" rel="noopener noreferrer" href="https://opensource.fb.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">CacheLib</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/installation/installation">Build and Installation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">API and Usage</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Cache_Library_User_Guides/Cachebench_Overview">Cachebench</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Cache_Library_Architecture_Guide/overview_a_random_walk">Architecture Guide</a><a class="navbar__item navbar__link" href="/">‌</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/learnmore/">Learn More</a><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_r8cw docMainContainerEnhanced_SOUu"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_XoVD"><div class="docItemContainer_6jsP"><article><header><h1 class="docTitle_ft6A">Monitoring cache health</h1></header><div class="markdown"><p>Cachelib offers both ODS and Scuba monitoring for your cache health. To enable monitoring, see <a href="/docs/facebook/Cache_Monitoring/Add_monitoring_for_cache">Add monitoring for cache</a>. In Scuba and ODS, you can find such information as hit rate, rate of allocations, eviction age, fragmentation, etc. This comprehensive set of metrics helps you to know how well your cache is performing or to debug issues related to your cachelib usage.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="cachelib-monitoring-dashboards"></a>CacheLib Monitoring Dashboards<a class="hash-link" href="#cachelib-monitoring-dashboards" title="Direct link to heading">#</a></h2><p>In addition to building your own dashboard (and adding alarms), you can also use Cachelib&#x27;s dashboards for high level metrics on how your cache is doing. We offer two dashboards:</p><ol><li><a href="https://fburl.com/unidash/ehpb743v" target="_blank" rel="noopener noreferrer">ODS</a> - High level cachelib metrics on ODS</li><li><a href="https://fburl.com/unidash/5l3bbo4u" target="_blank" rel="noopener noreferrer">Scuba</a> - Deeper dive into cachelib&#x27;s ram cache behavior</li></ol><p>Please contact our oncall if you have a feature request or any ideas to improve these dashboards further.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="ods"></a>ODS<a class="hash-link" href="#ods" title="Direct link to heading">#</a></h2><p>Cachelib publishes ODS stats via <em>service data</em> (which exports to the fb303 port). If you already use Thrift, you should already get the fb303 port free. Otherwise, you need to open a fb303 port in your service. For cachelib stats to show up on ODS, you must set up a monitoring config that registers cachelib’s stats. For example, <a href="https://fburl.com/diffusion/tk55n07s" target="_blank" rel="noopener noreferrer">see Feed Leaf&#x27;s fb303 monitoring</a>. Essentially you just need to add the following to your configerator config:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token module">cache</span><span class="token module punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token module">cachelib</span><span class="token module punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token module">cachelib</span><span class="token module punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token module">mon</span><span class="token module punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token module">cinc</span><span class="token plain"> as cachelib</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">add_cachelib_collector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cachelib_fb303&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">OPTIONAL</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> YOUR_FB303_PORT</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Cachelib ODS stats start with the prefix <code>cachelib.&lt;your_cache_name&gt;</code>. Many cachelib stats comes in the accumulative form. For example, <code>cachelib.&lt;your_cache_name&gt;.items.total</code> is the accumulative number of items in cache since your service has started. Other stats are offered in rate variants (for example, <code>cachelib.&lt;your_cache_name&gt;.cache.alloc_attempts.60</code>). If you think certain stats should be exported but are missing, reach out cachelib oncall for assistance.</p><p>The status is also broken down by pools. For example on DRAM cache size:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">size</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">usable_size</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">advised_size</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To obtain break-down of advised memory per pool:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">pool</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">size</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">pool</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">usable_size</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">pool</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">advised_size</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>For a complete list of cachelib ODS stats, see this file: <a href="https://fburl.com/diffusion/t2uvf1rd" target="_blank" rel="noopener noreferrer">https://fburl.com/diffusion/t2uvf1rd</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="scuba"></a>Scuba<a class="hash-link" href="#scuba" title="Direct link to heading">#</a></h2><p>We have several Scuba tables, each servering a different purpose. They help you to triage different type of issues. We&#x27;ll describe the three most relevant tables first, covering other tables in <a href="https://www.internalfb.com/intern/wiki/Cache_Library_User_Guides/monitoring/#Misc_Scuba_tables_for_debugging" target="_blank" rel="noopener noreferrer">Misc_Scuba_tables_for_debugging</a>. If you find any stat missing in this list of tables, contact us and we&#x27;ll add them here. Note that all our counters, Scuba or ODS, are accumulative counters. They are not rate of change counters.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="cachelib-admin-pool-stats"></a>Cachelib Admin pool stats<a class="hash-link" href="#cachelib-admin-pool-stats" title="Direct link to heading">#</a></h3><p>This dataset gives you high level information on how well your cache is doing. On a per-pool basis, you can find the following information: How many allocs are happening? How many items are there in my cache? How much fragmentation am I seeing? What&#x27;s the rate of eviction? See the sample <a href="https://fburl.com/scuba/nwhc6gb8" target="_blank" rel="noopener noreferrer">Cachelib Admin Pool Stats</a>.</p><p>Note all stats applies to an individual memory pool. If you only have one pool, then this is basically the global cache stats. Otherwise, you need to sum the stats for each pool to get true global cache stats.</p><ol><li><strong>Active Allocs</strong>
Number of outstanding allocations (items).</li><li><strong>Alloc Attempts</strong>
How many times you have called the <code>allocate()</code> function for this pool.</li><li><strong>Alloc Failures</strong> How many times of the above resulted in a failure. The cause is usually no free memory. A high rate of this indicates the rate of allocation is too much and evictions cannot keep up.</li><li><strong>Evictable Items</strong> Number of evictable allocations (items). Please recall cachelib also lets you allocate non-evictable items. This number should be always be less than or equal to Active Allocs.</li><li><strong>Unevictable Items</strong> We let you allocate permanent items (items that will never be evicted). This is the number of those. Beware that if this number is high (i.e., more than a few percent of the unevictable items), you may see performance impacts (suboptimal hit-rate and longer amount of time to rebalance your cache).</li><li><strong>Evictions</strong> Number of evictions since cache started.</li><li><strong>Fragmentation Size</strong> How much fragmentation there is. If this figure is more than 10% of your total pool size, it means you should consider customizing your allocation sizes in this pool to fit your allocations better. We have had use cases where we cut their fragmentation down from 15% to 5%, effectively giving them 10% more memory for caching.</li><li><strong>Free Allocs</strong> Number of allocations that are freed. Usually if you have not configured your cache with TTL or have logic that explicitly invalidates cached items, you should not see a high number for this stat.</li><li><strong>Free Memory</strong> This is the total memory footprint from Free Allocs and Free Slabs.</li><li><strong>Free Slabs</strong> This indicates how many slabs in your pool that are not being used. You&#x27;re expected to see this number when your cache is still warming up. However, in steady state, you should expect 0 or (very close to 0) across your tier.</li><li><strong>Invalid Allocs</strong> How many allocations were rejected because you requested for an invalid size; that is, the size requested is too big. We have a hard ceiling of 4 MB for the entire item, which means (4 MB - 31 bytes) for your key and value. Also you can lower this ceiling yourself (but not increase it).</li><li><strong>Items</strong> This is the same as Active Allocs. It&#x27;s redundant.</li><li><strong>Pool Get Hits</strong> How many hits there have been in this pool since the cache started. Unfortunately we&#x27;re not able to give you a hit-rate because we do not know which pool the misses went. If you only have one pool, then divide this number by the total requests to cache to get the equivalent to hit rate.</li><li><strong>Pool Size</strong> Configured size of this pool. This does not indicate how big this pool really is at this moment. It means how big this pool can grow to be. In general, in steady state, you should expect the total slabs stat to match this.</li><li><strong>Total Slabs</strong> The number of slabs in this pool. Used and unused. This stat multiplied by 4MB should be equal to <em>Pool Size</em> in steady state.</li><li><strong>Unallocated Slabs</strong> Number of slabs not yet allocated from the slab allocator. You&#x27;re expected to see this number when your cache is still warming up. However, in steady state, you should expect 0 or (very close to 0) across your tier.</li><li><strong>Min/Max Eviction Age</strong> This is the minimum and maximum eviction age for the allocation classes in this pool. Cachelib uses a slab allocator so different alloc sizes may have different eviction age. In general, this tells you that if you insert an item into this pool and never read it, how long you can expect this item to stay cached. It is a good approximate for retention time.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="cachelib-admin-ac-stats"></a>Cachelib Admin Ac Stats<a class="hash-link" href="#cachelib-admin-ac-stats" title="Direct link to heading">#</a></h3><p>This is similar to <em>cachelib admin pool stats</em> but a more in-depth view at each allocation class. Cachelib uses a slab allocator underneath, so we divide memory inside each pool into a set of allocation sizes. Each allocation size is an allocation class. This table gives you the following information: How many items are in this allocation size? How much fragmentation is there? Rate of eviction? How many free allocations are available? What is the eviction age? See the sample <a href="https://fburl.com/scuba/1yhoxsuu" target="_blank" rel="noopener noreferrer">Cachelib Admin Ac Stats</a>.</p><p>All the stats here applies to an individual allocation class. For example, your cache may be configured to have only two allocation sizes: 80 bytes and 1 MB. This means all your allocations will either be allocated from 80 bytes (if what you request via <code>CacheAllocator::allocate()</code> is less than or equal to 80 bytes) or 1 MB. Anything above 1 MB will result in an exception (reflected in the number of Invalid Allocs in Pool Stats). You will see two sets of AC stats for your pool. One refers to the 80-byte class and the other refers to the 1 MB class.</p><ol><li><strong>Active Allocs</strong> Same as Pool Stats but only for this allocation class.</li><li><strong>Alloc Attempts</strong> Same as above.</li><li><strong>Alloc Failures</strong> Same as above.</li><li><strong>Alloc Size</strong> The allocation size for this class. This is the real allocation you get when you request for a size that is less than or equal to this allocation class&#x27;s size. For example, if you have two AC&#x27;s: 80 bytes and 100 bytes. And you request for 92 bytes. You will get an allocation that is actually 100 bytes and thus you have just incurred a fragmentation of 8 bytes.</li><li><strong>Evictable Items</strong> Same as Pool Stats but only for this allocation class.</li><li><strong>Eviction Age</strong> This is how long your item for this allocation class will be cached if you never access it again after insertion. Use this to get a sense of how long the cache retention time is for all of your objects that are of this allocation size.</li><li><strong>Evictions</strong> Number of evictions in this allocation class since cache started up.</li><li><strong>Fragmentation Size</strong> Total amount of fragmentation incurred in this allocation class.</li><li><strong>Free Allocs</strong> Same as Pool stats but only apply for this allocation class.</li><li><strong>Free Slabs</strong> Same as above.</li><li><strong>Full</strong> This allocation class is full, which means it has zero free slab. Eviction is the only way to obtain new allocations.</li><li><strong>Lru Refresh Time Evictable</strong> How often do we promote an item on read or write? This applies only to evictable items.</li><li><strong>Lru Refresh Time Unevictable</strong> Same as above. Only applies to unevictable items.</li><li><strong>Num Hits</strong> Number of cache hits that are from items in this allocation class.</li><li><strong>Total Free Memory</strong>: The total available memory for allocations.</li><li><strong>Total Used Bytes</strong> How many bytes are used for allocations (this includes all the fragmentation incurred by allocations).</li><li><strong>Unevictable Items</strong> Same as Pool Stats but only for this allocation class.</li><li><strong>Used Slabs</strong> How many slabs are used currently by this allocation class.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="cachelib-admin-items-stats"></a>Cachelib Admin Items stats<a class="hash-link" href="#cachelib-admin-items-stats" title="Direct link to heading">#</a></h3><p>This table  gives you information on individual items that can help you reason about the composition of the cache. The table is populated by picking a random item weighted by its size and uploading the  metadata for  this item. Overtime (several days to a few weeks), you can get a very good idea on what sort of items live in your cache. For example, if you&#x27;re running a service like Memcache, you may be interested in finding out what are the top key families that consume most of your cache memory (items that start with the same key prefix is one key family). Some of the other stats we offer is how long this item has been around in cache and how much fragmentation was introduced by allocating this item. See the sample <a href="https://fburl.com/scuba/pnxdevhe" target="_blank" rel="noopener noreferrer">Cachelib Admin Items Stats</a>.</p><p>The following columns are available for sampled items.</p><ol><li><strong>Item Age</strong>   - time since the creation of the item.</li><li><strong>Key Size</strong> - the size of the key for the item.</li><li><strong>Value Size</strong> - the allocation size requested for the item in bytes.</li><li><strong>Total Item Size</strong> - the size requested for key and the value and item metadata.</li><li><strong>Alloc Size</strong> - the size class the item was allocated to.</li><li><strong>Fragmenation Size</strong> - unused fragmentation size for the item.</li><li><strong>Class Id</strong> - class id corresponding to the allocation.</li><li><strong>Pool Id</strong> - pool id corresponding to the allocation.</li><li><strong>Creation Time</strong> - time when the item was created.</li><li><strong>Est Lifetime</strong> - the ttl which was used to allocate the item.</li><li><strong>Ttl</strong> - time remaining from the sampling point to actual expiry of the item.</li><li><strong>Expiry Time</strong> - time when the item</li><li><strong>Is Chained Item</strong> - if the item is a  chained allocation that belongs to a chain of allocations.</li><li><strong>Has Chained Item</strong> - if the item is the parent item and has chained allocations.</li><li><strong>Key</strong> - the key for the item in binary format</li><li><strong>Hex Key</strong> - the key represented in hexadecimal format.</li></ol><blockquote><p>❗ IMPORTANT:</p><p>The cachelib_admin_item_stats table contains senstive cache information in raw form (key/hex-key). Due to this, the access to the table is restricted to cachelib team. If this data would be useful to debugging for your team in a particular issue, you can request temporary access through the scuba workflow.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="misc-scuba-tables-for-debugging"></a>Misc Scuba Tables for Debugging<a class="hash-link" href="#misc-scuba-tables-for-debugging" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="cachelib-logs"></a>Cachelib Logs<a class="hash-link" href="#cachelib-logs" title="Direct link to heading">#</a></h3><p>This table has all the logs cachelib internally writes (at a sampled rate). This can be useful for debugging. For example, suppose you notice one day that cachelib&#x27;s slab rebalancing is stuck on a few machines; you then filter for these hosts in this dataset, and you may find we&#x27;re logging some items are stuck in moving, which could then indicate a deadlock in the <code>movingSync</code> you supplied to us or point to an internal cachelib bug. You look at this table only when things are not working as expected.</p><p>Add the following to enable cachelib logging:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// In your program&#x27;s main.cpp:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">namespace</span><span class="token plain"> folly </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getBaseLoggingConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facebook</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">cachelib</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">registerCachelibScubaLogger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> CACHELIB_FOLLY_LOGGING_CONFIG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Alternatively, you can configure your own log levels.</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  return &quot;cachelib=&lt;LOG_LEVEL&gt;&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//                 &quot;:&lt;LOG_HANDLER&gt;&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//                 &quot;;&lt;LOG_HANDLER&gt;=&lt;NAME_OF_LOG_HANDLER&gt;&quot;;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  e.g., &quot;cachelib=ERR:cachelib_scuba;cachelib_scuba=cachelib_scuba_logger&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// namespace folly</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To override the default folly logging level, pass in a command line option when starting your binary or set the option via Thrift fb303. Refer to the folly logging documentation for more information on log levels and categories.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI none"><pre tabindex="0" class="prism-code language-none codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Change log level on startup.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Changes the default logging level to &quot;WARN&quot;. By default cachelib logs everything at INFO.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;your_binary&gt; --logging &quot;WARN&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Change log level during runtime.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Changes cachelib logging level to &quot;DBG&quot;. By default cachelib logs everything at INFO.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">buck build common/fb303/scripts:fb303_logging_config</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">buck-out/gen/common/fb303/scripts/fb303_logging_config.par \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --host &lt;YOUR_HOST&gt;:&lt;YOUR_FB303_PORT&gt; \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --update &#x27;cachelib:=DBG&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="cachelib-admin-metadata"></a>Cachelib Admin Metadata<a class="hash-link" href="#cachelib-admin-metadata" title="Direct link to heading">#</a></h3><p>(<strong>Deprecated</strong>) This table has some basic information such as cache version, cache size, and cache name. When a service running cachelib first starts, it sends a sample to this table. In general, this is a good way to visualize what version every cachelib user is running on. It is <strong>deprecated</strong> in favor of <em>Cachelib Admin Allocator Config</em>. See the sample <a href="https://fburl.com/scuba/0daj3xn9" target="_blank" rel="noopener noreferrer">Cachelib Admin Metadata</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="cachelib-admin-allocator-config"></a>Cachelib Admin allocator config<a class="hash-link" href="#cachelib-admin-allocator-config" title="Direct link to heading">#</a></h3><p>This is intended to replace <em>Cachelib Admin Metadata</em>. It uploads everything the metadata table does and also uploads all the cache configurations. This will be very useful to check what config your service is running (when you&#x27;re rolling out a new change for example or debugging an on-going issue). For example, you can find out which host has slab rebalancing enabled or how big the hash table is configured for a particular tier.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/CacheLib/edit/main/website/docs/facebook/Cache_Monitoring/monitoring.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cachelib-monitoring-dashboards" class="table-of-contents__link">CacheLib Monitoring Dashboards</a></li><li><a href="#ods" class="table-of-contents__link">ODS</a></li><li><a href="#scuba" class="table-of-contents__link">Scuba</a><ul><li><a href="#cachelib-admin-pool-stats" class="table-of-contents__link">Cachelib Admin pool stats</a></li><li><a href="#cachelib-admin-ac-stats" class="table-of-contents__link">Cachelib Admin Ac Stats</a></li><li><a href="#cachelib-admin-items-stats" class="table-of-contents__link">Cachelib Admin Items stats</a></li></ul></li><li><a href="#misc-scuba-tables-for-debugging" class="table-of-contents__link">Misc Scuba Tables for Debugging</a><ul><li><a href="#cachelib-logs" class="table-of-contents__link">Cachelib Logs</a></li><li><a href="#cachelib-admin-metadata" class="table-of-contents__link">Cachelib Admin Metadata</a></li><li><a href="#cachelib-admin-allocator-config" class="table-of-contents__link">Cachelib Admin allocator config</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Reach Us</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/cachelib/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook Developer Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/MetaOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright © 2022 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.82aea47b.js"></script>
<script src="/assets/js/main.66604c68.js"></script>
</body>
</html>
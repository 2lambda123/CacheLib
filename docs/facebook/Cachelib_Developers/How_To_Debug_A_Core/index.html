<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CacheLib Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CacheLib Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="CacheLib" href="/opensearch.xml"><title data-react-helmet="true">How To Debug A Core | CacheLib</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-react-helmet="true" name="twitter:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-react-helmet="true" property="og:url" content="https://cachelib.org/docs/facebook/Cachelib_Developers/How_To_Debug_A_Core"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How To Debug A Core | CacheLib"><meta data-react-helmet="true" name="description" content="[WORK IN PROGRESS]"><meta data-react-helmet="true" property="og:description" content="[WORK IN PROGRESS]"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cachelib.org/docs/facebook/Cachelib_Developers/How_To_Debug_A_Core"><link data-react-helmet="true" rel="alternate" href="https://cachelib.org/docs/facebook/Cachelib_Developers/How_To_Debug_A_Core" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cachelib.org/docs/facebook/Cachelib_Developers/How_To_Debug_A_Core" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.88c68b34.css">
<link rel="preload" href="/assets/js/runtime~main.d499e1a3.js" as="script">
<link rel="preload" href="/assets/js/main.70a77d5d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#20232a;color:#fff" role="banner"><div class="announcementBarContent_6uhP">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.fb.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">CacheLib</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/installation/installation">Build and Installation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">API and Usage</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Cache_Library_User_Guides/Cachebench_Overview">Cachebench</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Cache_Library_Architecture_Guide/overview_a_random_walk">Architecture Guide</a><a class="navbar__item navbar__link" href="/">â€Œ</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/learnmore/">Learn More</a><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_r8cw docMainContainerEnhanced_SOUu"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_XoVD"><div class="docItemContainer_6jsP"><article><header><h1 class="docTitle_ft6A">How To Debug A Core</h1></header><div class="markdown"><p><strong>[WORK IN PROGRESS]</strong></p><p>GDB is your friend. Here&#x27;s a quick-start guide to using GDB. <a href="http://beej.us/guide/bggdb/" target="_blank" rel="noopener noreferrer">http://beej.us/guide/bggdb/</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="find-the-core-file"></a>Find the core file<a class="hash-link" href="#find-the-core-file" title="Direct link to heading">#</a></h2><p>Find out where the core is located. It&#x27;s typically in <code>/var/tmp/cores/</code> on the host where a crash had happened. You can also manually trigger a coredump via <code>kill -3</code> on the process that you want to dump a core. To find the process, you can search for its name. (E.g. <code>ps aux | grep &lt;name&gt;</code>).</p><p>Alternatively, see if you can find the core via <a href="https://fburl.com/scuba/coredumper/s85b6cvg" target="_blank" rel="noopener noreferrer">coredumper</a>. You can follow <a href="https://www.internalfb.com/intern/wiki/Coredumper/User_Guide/Remote_Coredumps/#quickstart-guide" target="_blank" rel="noopener noreferrer">this guide</a> to figure out how to download and access the core.</p><p>Once you have the location of the core, use fbpkg to fetch the package. You can do this by <code>fbpkg.fetch &lt;package_name&gt;</code>. Typically, if you get a task about a crash while oncall, it should contain the package and version for the service that had the crash. Simply <code>sush</code> onto the host, fetch the package, and examine the core <code>gdb &lt;binary&gt; /var/tmp/cores/&lt;core&gt;</code>. Some times the task itself has the complete command for you to log onto a host and examine the core, so you can copy-paste that as well.</p><p>This wiki has a few helper commands for you to navigate around cachelib.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="how-to-access-cacheallocator"></a>How to access CacheAllocator<a class="hash-link" href="#how-to-access-cacheallocator" title="Direct link to heading">#</a></h2><p><strong>TAO</strong></p><p>To examine cache, first make sure you have loaded all the debug symbols.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fbload auto_debuginfo</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">auto</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">load</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">debuginfo</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fbload debuginfo_fbpkg</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">load_debuginfo</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Next, navigate to a place where you have visibility to global variables defined in <code>tao/server/globals.cpp</code>. A frame that is located in <code>main.cpp</code> will give you visibility. After this, you can examine the caches. We have two caches for TAO: gCache and gRecentWritesCache.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Look inside gRecentWritesCache</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">p </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">gRecentWritesCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_head_impl</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Examine cache-allocator object inside gRecentWritesCache</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">p </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">gRecentWritesCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_head_impl</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">cache_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_head_impl</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Look inside gCache</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">p </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">gCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_head_impl</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Examine cache-allocator object inside gCache</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">p </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">gCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_head_impl</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">cache_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_head_impl</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>BigCache</strong></p><p>tbd</p><p><strong>Memcache</strong></p><p>tbd</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="how-to-examine-cacheallocator"></a>How to examine CacheAllocator<a class="hash-link" href="#how-to-examine-cacheallocator" title="Direct link to heading">#</a></h2><p>First verify if we have a full coredump. You can check that by using our cache allocator config scuba dataset. Filter by the host which the crash happened on. Then, check &quot;disableFullCoredump&quot;. If it&#x27;s true, then we don&#x27;t have a full core which means we cannot look inside the cache memory. We can still examine other members of the CacheAllocator though. You can look at access container, and mm container for example. You can also examine navy&#x27;s index and various components if using nvmcache.</p><p><strong>Examine cache memory</strong></p><p>There&#x27;re several ways. You can examine access container or mm container, and navigate to a cachelib item from there. Or, you can start from the beginning of cache memory and examine slab headers, and then cachelib items one by one.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Look at the beginning of cache memory</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache ptr</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">allocator_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_M_head_impl</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">slabAllocator_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">slabMemoryStart_</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>tbd</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/CacheLib/edit/main/website/docs/facebook/Cachelib_Developers/How_To_Debug_A_Core.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#find-the-core-file" class="table-of-contents__link">Find the core file</a></li><li><a href="#how-to-access-cacheallocator" class="table-of-contents__link">How to access CacheAllocator</a></li><li><a href="#how-to-examine-cacheallocator" class="table-of-contents__link">How to examine CacheAllocator</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Reach Us</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/cachelib/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook Developer Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/MetaOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d499e1a3.js"></script>
<script src="/assets/js/main.70a77d5d.js"></script>
</body>
</html>